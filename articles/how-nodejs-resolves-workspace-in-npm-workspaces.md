---
title: "Node.jsã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è§£æ±ºã¨npm workspacesã«ãŠã‘ã‚‹ãƒ¢ãƒãƒ¬ãƒå‚ç…§ã®ä»•çµ„ã¿"
emoji: "ğŸ”"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["npm", "nodejs", "typescript", "javascript"]
published: true
---

## ã¯ã˜ã‚ã«

ãƒ¢ãƒãƒ¬ãƒã‚’åˆ©ç”¨ã—ã¯ã˜ã‚ã‚‹ã«ã‚ãŸã£ã¦ã€npm workspacesã§ä»–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å‚ç…§ã™ã‚‹ä»•çµ„ã¿ã‚’èª¿ã¹ãŸã®ã§ã¾ã¨ã‚ã¾ã—ãŸã€‚

## 1. Node.jsã®åŸºæœ¬ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è§£æ±ºãƒ«ãƒ¼ãƒ«

Node.jsã§ã¯ã€`require('foo')` ã®ã‚ˆã†ã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åãŒæ¸¡ã•ã‚ŒãŸã¨ãã€æ¬¡ã®é †ã§æ¢ç´¢ã—ã¾ã™ã€‚

1. **ã‚³ã‚¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ç¢ºèª**
`http` ã‚„ `fs` ãªã©ã€Node.jsã«çµ„ã¿è¾¼ã¿ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã‚ã‚Œã°ãã‚Œã‚’å³åº§ã«è¿”ã™ã€‚

2. **ç›¸å¯¾ï¼çµ¶å¯¾ãƒ‘ã‚¹æŒ‡å®šã®ç¢ºèª**
`./foo` ã‚„ `/path/to/foo` ã®ã‚ˆã†ã«ãƒ‘ã‚¹ã§æŒ‡å®šã•ã‚ŒãŸå ´åˆã¯ã€ãã®ãƒ‘ã‚¹ã‚’ç›´æ¥è§£æ±ºã€‚

3. **åå‰ï¼ˆè­˜åˆ¥å­ï¼‰ã«ã‚ˆã‚‹æ¢ç´¢**
ç¾åœ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰é †ã«ä¸Šä½ã¸è¾¿ã‚Šã€`node_modules` ã‚’æ¢ã™ã€‚
ä¾‹ï¼š `/project/src/index.js` ã‹ã‚‰ `require('foo')` ã‚’å®Ÿè¡Œã—ãŸå ´åˆ

```
/project/src/node_modules/foo
/project/node_modules/foo
/node_modules/foo
```

:::message
**ãƒã‚¤ãƒ³ãƒˆï¼š** Node.jsã¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’ã€Œç¾åœ¨åœ°ã‹ã‚‰ä¸Šã«å‘ã‹ã£ã¦ã€æ¢ã—ã¦ã„ã
:::

## 2. npm workspacesã®å‹•ä½œ

npm workspacesã¯ã€ãƒ¢ãƒãƒ¬ãƒæ§‹æˆã§è¤‡æ•°ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä¸€æ‹¬ç®¡ç†ã™ã‚‹ä»•çµ„ã¿ã§ã™ã€‚

- ãƒ«ãƒ¼ãƒˆã® `package.json` ã« `"workspaces"` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¨­å®š
- ãƒ«ãƒ¼ãƒˆã§ `npm install` ã‚’å®Ÿè¡Œã™ã‚‹ã¨
  - å…±é€šä¾å­˜ã‚’**ãƒ«ãƒ¼ãƒˆã® `node_modules`**ã«hoistï¼ˆé›†ç´„ï¼‰
  - å„ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’**ãƒ«ãƒ¼ãƒˆã® `node_modules` ã«ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯**ã¨ã—ã¦é…ç½®ï¼ˆã“ã¡ã‚‰ãŒé‡è¦ï¼‰

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¾‹ï¼š

```
/project
â”œâ”€â”€ node_modules
â”‚   â”œâ”€â”€ package-a -> ../packages/package-a (symlink)
â”‚   â””â”€â”€ package-b -> ../packages/package-b (symlink)
â””â”€â”€ packages
    â”œâ”€â”€ package-a
    â”‚   â””â”€â”€ package.json
    â””â”€â”€ package-b
        â””â”€â”€ package.json
```

:::message
**ãƒã‚¤ãƒ³ãƒˆï¼š** npm workspacesã¯å„ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ«ãƒ¼ãƒˆã® `node_modules` ã«ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã¨ã—ã¦é…ç½®ã™ã‚‹
:::

## 3. ãƒ¢ãƒãƒ¬ãƒã§ä»–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å‚ç…§ã§ãã‚‹ç†ç”±

ä¾‹ã¨ã—ã¦ `/project/packages/package-b/index.js` ã§

```js
require('package-a');
```

ã‚’å®Ÿè¡Œã—ãŸå ´åˆã®Node.jsã®æ¢ç´¢é †ã¯ã“ã†ãªã‚Šã¾ã™ã€‚

1. /project/packages/package-b/node_modules/package-a â†’ å­˜åœ¨ã—ãªã„
2. /project/packages/node_modules/package-a â†’ å­˜åœ¨ã—ãªã„
3. /project/node_modules/package-a â†’ symlinkãŒã‚ã‚‹ã®ã§ãƒ’ãƒƒãƒˆ
4. ä»¥é™ã®æ¢ç´¢ã¯ä¸è¦

ã¤ã¾ã‚Šã€Node.jsè‡ªä½“ã¯é€šå¸¸é€šã‚Šã€Œä¸‹ã‹ã‚‰ä¸Šã¸é †ã«ã€æ¢ç´¢ã—ã¦ã„ã¾ã™ãŒã€npm workspacesãŒå„ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ«ãƒ¼ãƒˆã® `node_modules` ã«ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã¨ã—ã¦é…ç½®ã—ã¦ã„ã‚‹ãŸã‚ã€ä»–ã®ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚’å‚ç…§ã§ãã¾ã™ã€‚
